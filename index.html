<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI è¡ŒéŠ·é•·æ¨¡æ“¬å™¨ï¼šæˆ¶å¤–ç”¨å“å“ç‰Œçš„æ•¸ä½è½‰å‹</title>
    
    <!-- React & ReactDOM (Production Version for better performance) -->
    <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons (Fixed Version for stability) -->
    <script src="https://unpkg.com/lucide@0.292.0/dist/umd/lucide.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; }
        .glass-panel {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .gradient-bg {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
        }
        .animate-fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="gradient-bg min-h-screen text-slate-800">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // --- Icons components from Lucide ---
        // ä½¿ç”¨ UMD ç‰ˆæœ¬çš„ window.lucide.icons
        const Icon = ({ name, size = 24, className }) => {
            const [iconData, setIconData] = useState(null);

            useEffect(() => {
                // ç¢ºä¿ lucide å·²è¼‰å…¥
                if (window.lucide && window.lucide.icons && window.lucide.icons[name]) {
                    setIconData(window.lucide.icons[name]);
                }
            }, [name]);

            if (!iconData) return null;

            return (
                <svg 
                    xmlns="http://www.w3.org/2000/svg" 
                    width={size} 
                    height={size} 
                    viewBox="0 0 24 24" 
                    fill="none" 
                    stroke="currentColor" 
                    strokeWidth="2" 
                    strokeLinecap="round" 
                    strokeLinejoin="round"
                    className={className}
                >
                    {iconData.map((element, index) => {
                        // FIX: å¢åŠ æª¢æŸ¥ä»¥ç¢ºä¿ element æ˜¯æœ‰æ•ˆçš„é™£åˆ—ï¼Œé˜²æ­¢ TypeError: Invalid attempt to destructure non-iterable instance
                        if (!Array.isArray(element) || element.length < 2) return null;
                        
                        const [tag, attrs] = element;
                        return React.createElement(tag, { ...attrs, key: index });
                    })}
                </svg>
            );
        };

        // --- Data & Content ---
        const STAGES = [
            {
                id: 1,
                title: "éšæ®µä¸€ï¼šæ•¸æ“šæ¸…æ´—èˆ‡æ•´åˆ",
                subtitle: "Data Pipeline & Cleaning",
                desc: "å®˜ç¶²å’Œè¦çš®çš„å ±è¡¨æ ¼å¼ä¸åŒï¼ŒAI ç„¡æ³•åˆ†æã€‚è«‹æ‰®æ¼”ã€Œæ•¸æ“šæ¸…æ½”å·¥ã€ï¼Œåˆ©ç”¨ Python é‚è¼¯å°‡å•†å“å°æ‡‰èµ·ä¾†ã€‚",
                tool: "ChatGPT / Python Script",
                type: "matching"
            },
            {
                id: 2,
                title: "éšæ®µäºŒï¼šAI èªæ„è²¼æ¨™",
                subtitle: "NLP & Tagging",
                desc: "æ”¶é›†åˆ°äº†å¤§é‡è©•è«–ï¼Œä½†ä¸çŸ¥é“å®¢æˆ¶æ˜¯èª°ã€‚è«‹æ‰®æ¼”ã€ŒNLP æ¨¡å‹ã€ï¼Œåˆ†ææ–‡å­—èƒŒå¾Œçš„æ„åœ–ä¸¦è²¼ä¸Šæ­£ç¢ºæ¨™ç±¤ã€‚",
                tool: "OpenAI API / MonkeyLearn",
                type: "tagging"
            },
            {
                id: 3,
                title: "éšæ®µä¸‰ï¼šé æ¸¬èˆ‡é–å®š",
                subtitle: "Prediction & Targeting",
                desc: "é ç®—æœ‰é™ï¼Œä¸èƒ½äº‚æ§æ‰“é³¥ã€‚è«‹æ ¹æ“š AI æä¾›çš„ RFM æ•¸æ“šï¼Œæ‰¾å‡ºã€Œé«˜æ½›åŠ›è½‰åŒ–ã€çš„ç›®æ¨™ã€‚",
                tool: "Klaviyo / CRM AI",
                type: "prediction"
            },
            {
                id: 4,
                title: "éšæ®µå››ï¼šè‡ªå‹•åŒ–åŸ·è¡Œ",
                subtitle: "AI-Driven Execution",
                desc: "é‡å°é–å®šçš„æ—ç¾¤ï¼Œè®“ AI è‡ªå‹•é¸æ“‡æœ€èƒ½æ‰“å‹•ä»–å€‘çš„å»£å‘Šç´ æã€‚",
                tool: "Meta Advantage+ / Midjourney",
                type: "execution"
            }
        ];

        const KNOWLEDGE_BASE = {
            "SKU": "Stock Keeping Unitï¼Œåº«å­˜å–®ä½ã€‚é›»å•†ä¸­æ¯å€‹å•†å“çš„å”¯ä¸€èº«åˆ†è­‰ã€‚",
            "NLP": "Natural Language Processingï¼Œè‡ªç„¶èªè¨€è™•ç†ã€‚è®“é›»è…¦è®€æ‡‚äººé¡èªè¨€ï¼ˆå¦‚è©•è«–ã€å®¢æœå°è©±ï¼‰çš„ AI æŠ€è¡“ã€‚",
            "RFM": "Recency (æœ€è¿‘è³¼è²·æ—¥), Frequency (é »ç‡), Monetary (é‡‘é¡)ã€‚ç¶“å…¸çš„å®¢æˆ¶åˆ†ç¾¤æ¨¡å‹ã€‚",
            "ROAS": "Return on Ad Spendï¼Œå»£å‘ŠæŠ•è³‡å ±é…¬ç‡ã€‚æ¯èŠ± 1 å…ƒå»£å‘Šè²»èƒ½è³ºå›å¹¾å…ƒç‡Ÿæ”¶ã€‚",
            "CDP": "Customer Data Platformï¼Œå®¢æˆ¶æ•¸æ“šå¹³å°ã€‚æ•´åˆä¾†è‡ªå®˜ç¶²ã€APPã€é–€å¸‚ç­‰æ‰€æœ‰é€šè·¯çš„æ•¸æ“šä¸­å¿ƒã€‚"
        };

        // --- Components ---

        const ProgressBar = ({ current, total }) => (
            <div className="w-full bg-slate-700 h-2 rounded-full mb-6">
                <div 
                    className="bg-emerald-500 h-2 rounded-full transition-all duration-500"
                    style={{ width: `${(current / total) * 100}%` }}
                ></div>
            </div>
        );

        const FeedbackModal = ({ isOpen, isCorrect, message, tool, onNext }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4 animate-fade-in">
                    <div className="bg-white rounded-xl max-w-md w-full p-6 shadow-2xl border-t-4 border-emerald-500">
                        <div className="flex items-center gap-3 mb-4">
                            <div className={`p-3 rounded-full ${isCorrect ? 'bg-emerald-100 text-emerald-600' : 'bg-rose-100 text-rose-600'}`}>
                                <Icon name={isCorrect ? "CheckCircle" : "XCircle"} size={32} />
                            </div>
                            <h3 className="text-xl font-bold">{isCorrect ? "æ±ºç­–æ­£ç¢ºï¼" : "æ±ºç­–å¤±èª¤..."}</h3>
                        </div>
                        <p className="text-slate-600 mb-4 leading-relaxed">{message}</p>
                        <div className="bg-slate-100 p-3 rounded-lg mb-6 text-sm">
                            <span className="font-bold text-slate-700 block mb-1">ğŸ’¡ æ ¸å¿ƒ AI å·¥å…·ï¼š</span>
                            {tool}
                        </div>
                        <button 
                            onClick={onNext}
                            className="w-full bg-slate-900 text-white py-3 rounded-lg font-bold hover:bg-slate-800 transition-colors"
                        >
                            {isCorrect ? "é€²å…¥ä¸‹ä¸€é—œ" : "å†è©¦ä¸€æ¬¡"}
                        </button>
                    </div>
                </div>
            );
        };

        // --- Game Stages ---

        const Stage1_Matching = ({ onComplete }) => {
            const [selectedA, setSelectedA] = useState(null);
            
            const colA = [
                { id: 'a1', text: "è¦çš®ï¼š[ç¾è²¨] åŒ—è‡‰é˜²é¢¨å¤–å¥— é»‘", match: 'b2' },
                { id: 'a2', text: "MOMOï¼šè¼•é‡ç™»å±±æ– (ä¸€å°)", match: 'b3' },
                { id: 'a3', text: "è¦çš®ï¼šéœ²ç‡Ÿç¾å­¸ æ‰‹æ²–å£º", match: 'b1' },
            ];
            const colB = [
                { id: 'b1', text: "å®˜ç¶²ï¼šCamping Coffee Pot - Silver", match: 'a3' },
                { id: 'b2', text: "å®˜ç¶²ï¼šTNF Windbreaker JKT (BLK)", match: 'a1' },
                { id: 'b3', text: "å®˜ç¶²ï¼šCarbon Trekking Poles", match: 'a2' },
            ];

            const handleCheck = (itemB) => {
                if (!selectedA) return;
                if (itemB.match === selectedA.id) {
                    onComplete(true, "å¤ªæ£’äº†ï¼é€™å°±æ˜¯ã€ŒSKU Mappingã€ã€‚AI é€éé—œéµå­—ï¼ˆå¦‚ 'é˜²é¢¨å¤–å¥—' å°æ‡‰ 'Windbreaker'ï¼‰å°‡ä¸åŒé€šè·¯çš„æ•¸æ“šåˆä½µï¼Œè®“æˆ‘å€‘çŸ¥é“é€™æ¬¾å¤–å¥—åœ¨å…¨ç¶²çš„ç¸½éŠ·é‡ã€‚", "ChatGPT Code Interpreter / Python");
                } else {
                    onComplete(false, "å°æ‡‰éŒ¯èª¤ã€‚AI éœ€è¦æ›´ç²¾ç¢ºçš„é‚è¼¯ã€‚ä¾‹å¦‚ã€Œæ‰‹æ²–å£ºã€æ‡‰è©²å°æ‡‰ã€ŒCoffee Potã€ã€‚è«‹å†è©¦ä¸€æ¬¡ã€‚", "ChatGPT Code Interpreter / Python");
                }
                setSelectedA(null);
            };

            return (
                <div className="space-y-6">
                    <div className="bg-blue-50 p-4 rounded-lg border border-blue-200 mb-4 text-sm text-blue-800">
                        <span className="font-bold">ä»»å‹™ç›®æ¨™ï¼š</span> è«‹é»æ“Šå·¦å´çš„ã€Œè¦çš®/MOMO å•†å“ã€ï¼Œå†é»æ“Šå³å´å°æ‡‰çš„ã€Œå®˜ç¶² SKUã€é€²è¡Œåˆä½µã€‚
                    </div>
                    <div className="grid grid-cols-2 gap-8">
                        <div className="space-y-3">
                            <h4 className="font-bold text-slate-500 text-sm">ä¾†æº Aï¼šå¤–éƒ¨é€šè·¯å ±è¡¨</h4>
                            {colA.map(item => (
                                <button 
                                    key={item.id}
                                    onClick={() => setSelectedA(item)}
                                    className={`w-full p-4 text-left rounded-lg border transition-all ${selectedA?.id === item.id ? 'border-emerald-500 bg-emerald-50 ring-2 ring-emerald-200' : 'border-slate-200 bg-white hover:border-blue-300'}`}
                                >
                                    {item.text}
                                </button>
                            ))}
                        </div>
                        <div className="space-y-3">
                            <h4 className="font-bold text-slate-500 text-sm">ä¾†æº Bï¼šå®˜ç¶²è³‡æ–™åº«</h4>
                            {colB.map(item => (
                                <button 
                                    key={item.id}
                                    onClick={() => handleCheck(item)}
                                    className="w-full p-4 text-left rounded-lg border border-slate-200 bg-white hover:border-blue-300 transition-all hover:bg-slate-50"
                                >
                                    {item.text}
                                </button>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        const Stage2_Tagging = ({ onComplete }) => {
            const comment = "é€™é€±æœ«å»åˆæ­¡åŒ—å³°ï¼Œé€™ä»¶å¤–å¥—çœŸçš„å¾ˆè¼•ï¼Œå°±ç®—èƒŒåŒ…å¾ˆé‡ä¹Ÿæ²’è² æ“”ã€‚ä½†æ˜¯é¡è‰²åªæœ‰é»‘è‰²æœ‰é»å–®èª¿ï¼Œæ‹ç…§ä¸å¤ äº®ã€‚";
            
            const tags = [
                { id: 't1', label: "é¢¨æ ¼éœ²ç‡Ÿ (Glamping)", correct: false },
                { id: 't2', label: "ç¡¬æ ¸ç™»å±± (Mountaineering)", correct: true },
                { id: 't3', label: "åŸå¸‚æ©Ÿèƒ½ (Urban)", correct: false }
            ];

            const handleSelect = (tag) => {
                if (tag.correct) {
                    onComplete(true, "æ­£ç¢ºè­˜åˆ¥ï¼é—œéµå­—ã€Œåˆæ­¡åŒ—å³°ã€ã€ã€ŒèƒŒåŒ…è² é‡ã€ã€ã€Œè¼•é‡ã€é¡¯ç¤ºé€™æ˜¯ç™»å±±å®¢ã€‚é›–ç„¶ä»–æŠ±æ€¨é¡è‰²ï¼Œä½†æ ¸å¿ƒè¡Œç‚ºæ˜¯ç™»å±±ã€‚é€™é¡æ¨™ç±¤èƒ½å¹«åŠ©æˆ‘å€‘æ¨è–¦æ©Ÿèƒ½æ€§å¼·çš„ç”¢å“ã€‚", "NLP API (Google Cloud / OpenAI)");
                } else {
                    onComplete(false, "åˆ¤æ–·ä¸å¤ ç²¾æº–ã€‚è«‹æ³¨æ„é—œéµå­—ã€Œåˆæ­¡åŒ—å³°ã€ã€ã€ŒèƒŒåŒ…å¾ˆé‡ã€ã€‚é€™ä¸æ˜¯ä¼‘é–’éœ²ç‡Ÿæˆ–åŸå¸‚ç©¿æ­çš„æƒ…å¢ƒã€‚", "NLP API (Google Cloud / OpenAI)");
                }
            };

            return (
                <div className="space-y-6">
                     <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                        <div className="flex gap-3 mb-2">
                            <div className="w-8 h-8 rounded-full bg-slate-200 flex items-center justify-center">
                                <Icon name="User" size={16} />
                            </div>
                            <span className="font-bold text-slate-700">å®¢æˆ¶è©•è«–</span>
                        </div>
                        <p className="text-lg text-slate-800 leading-relaxed">"{comment}"</p>
                    </div>

                    <div className="bg-blue-50 p-4 rounded-lg border border-blue-200 text-sm text-blue-800">
                        <span className="font-bold">ä»»å‹™ç›®æ¨™ï¼š</span> AI åˆ†æäº†é€™æ®µæ–‡å­—ï¼Œè«‹å•è©²å°‡é€™ä½å®¢æˆ¶æ­¸é¡ç‚ºå“ªä¸€é¡å—çœ¾ï¼Ÿ
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        {tags.map(tag => (
                            <button
                                key={tag.id}
                                onClick={() => handleSelect(tag)}
                                className="p-6 rounded-xl border-2 border-slate-200 bg-white hover:border-emerald-400 hover:bg-emerald-50 transition-all group"
                            >
                                <div className="mb-2 text-emerald-600 opacity-50 group-hover:opacity-100">
                                    <Icon name="Tag" size={32} className="mx-auto" />
                                </div>
                                <div className="font-bold text-lg">{tag.label}</div>
                            </button>
                        ))}
                    </div>
                </div>
            );
        };

        const Stage3_Prediction = ({ onComplete }) => {
            const profiles = [
                { 
                    id: 'p1', 
                    name: "è¨ªå®¢ A", 
                    data: "æœ€è¿‘è³¼è²·: 3å¤©å‰ | é »ç‡: 1æ¬¡ | é‡‘é¡: $150", 
                    behavior: "è²·äº†ä¸€é›™è¥ªå­ï¼Œä¹‹å¾Œæ²’å†ä¾†éã€‚",
                    isHighValue: false 
                },
                { 
                    id: 'p2', 
                    name: "è¨ªå®¢ B (æœªç™»å…¥)", 
                    data: "æœ€è¿‘è³¼è²·: ç„¡ | é »ç‡: 0 | ç€è¦½: 15æ¬¡", 
                    behavior: "é€£çºŒä¸‰å¤©ç€è¦½åŒä¸€æ¬¾é«˜åƒ¹å¸³ç¯·ï¼ŒåŠ å…¥è³¼ç‰©è»Š2æ¬¡ä½†æœªçµå¸³ã€‚",
                    isHighValue: true 
                },
                { 
                    id: 'p3', 
                    name: "æœƒå“¡ C", 
                    data: "æœ€è¿‘è³¼è²·: 180å¤©å‰ | é »ç‡: 5æ¬¡ | é‡‘é¡: $2000", 
                    behavior: "åŠå¹´å‰è²·å¾ˆå¤šï¼Œä½†æœ€è¿‘åŠå¹´å®Œå…¨æ²’é–‹å•Ÿéä¿¡ä»¶ã€‚",
                    isHighValue: false 
                }
            ];

            const handleSelect = (p) => {
                if (p.isHighValue) {
                    onComplete(true, "ç²¾æº–å‘½ä¸­ï¼é›–ç„¶è¨ªå®¢ B é‚„æ²’è³¼è²·ï¼Œä½†é«˜é »ç‡ç€è¦½ + åŠ å…¥è³¼ç‰©è»Š (Add to Cart) æ˜¯æ¥µå¼·çš„ã€Œè³¼è²·æ„åœ– (High Intent)ã€ã€‚AI é æ¸¬ä»–ä¸‹å–®æ©Ÿç‡æœ€é«˜ï¼Œæ‡‰è©²ç«‹åˆ»ç™¼é€ã€Œå…é‹å„ªæƒ åˆ¸ã€æ¨ä¸€æŠŠï¼", "Klaviyo / AI Predictive Modeling");
                } else {
                    let reason = p.id === 'p1' ? "è¨ªå®¢ A å‰›è²·éä¸”é‡‘é¡ä½ï¼ŒçŸ­æœŸå›è³¼ç‡ä½ã€‚" : "æœƒå“¡ C å·²ç¶“æµå¤± (Churned)ï¼ŒæŒ½å›é›£åº¦é«˜ã€‚";
                    onComplete(false, `é¸æ“‡é¢¨éšªè¼ƒé«˜ã€‚${reason} è«‹å°‹æ‰¾æ›´æœ‰ã€Œå³æ™‚éœ€æ±‚ã€çš„ä¿¡è™Ÿã€‚`, "Klaviyo / AI Predictive Modeling");
                }
            };

            return (
                <div className="space-y-6">
                    <div className="bg-blue-50 p-4 rounded-lg border border-blue-200 text-sm text-blue-800">
                        <span className="font-bold">ä»»å‹™ç›®æ¨™ï¼š</span> æ ¹æ“š AI æ”¶é›†çš„è¡Œç‚ºæ•¸æ“šï¼Œå“ªä¸€ä½æœ€æœ‰å¯èƒ½æ˜¯ã€Œé€™é€±å°±æœƒä¸‹å–®ã€çš„é«˜åƒ¹å€¼å®¢æˆ¶ï¼Ÿ
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        {profiles.map(p => (
                            <div key={p.id} className="bg-white p-5 rounded-xl border border-slate-200 shadow-sm hover:shadow-md transition-all">
                                <div className="flex items-center gap-2 mb-3">
                                    <div className="bg-slate-100 p-2 rounded-full"><Icon name="User" size={20} /></div>
                                    <h3 className="font-bold text-lg">{p.name}</h3>
                                </div>
                                <div className="text-xs text-slate-500 bg-slate-50 p-2 rounded mb-3 font-mono">
                                    {p.data}
                                </div>
                                <p className="text-sm text-slate-700 mb-4 h-12">{p.behavior}</p>
                                <button 
                                    onClick={() => handleSelect(p)}
                                    className="w-full py-2 border-2 border-emerald-500 text-emerald-600 font-bold rounded-lg hover:bg-emerald-500 hover:text-white transition-colors"
                                >
                                    é–å®šæ­¤äºº
                                </button>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        const Stage4_Execution = ({ onComplete }) => {
            // Persona: Family Camping
            const persona = {
                tag: "è¦ªå­éœ²ç‡Ÿæ— (Family Camper)",
                needs: "ç©ºé–“å¤§ã€å®‰å…¨ã€å®¹æ˜“æ­å»ºã€æ°›åœæ„Ÿ"
            };

            const ads = [
                { 
                    id: 'ad1', 
                    title: "æ¥µé™æ”»é ‚çµ„", 
                    imgDesc: "æš´é¢¨é›ªä¸­çš„ä¸€äººå¸³ï¼Œå¼·èª¿æŠ—é¢¨ä¿‚æ•¸", 
                    copy: "æŒ‘æˆ°æ¥µé™ï¼Œç„¡æ‡¼é¢¨é›ªã€‚Gore-tex Pro å¼·åŠ›é˜²è­·ã€‚",
                    correct: false
                },
                { 
                    id: 'ad2', 
                    title: "é€±æœ«æ­¡æ¨‚çµ„", 
                    imgDesc: "è‰åœ°ä¸Šçš„ä¸€å®¶å››å£ï¼Œå¤§å¸³ç¯·æ—æœ‰ç‡Ÿç«èˆ‡å­©å­ç¬‘è‡‰", 
                    copy: "åªè¦ 10 åˆ†é˜è¼•é¬†æ­å»ºã€‚çµ¦å­©å­ä¸€å€‹é›£å¿˜çš„é€±æœ«æ˜Ÿç©ºã€‚",
                    correct: true
                },
                { 
                    id: 'ad3', 
                    title: "åŸå¸‚é€šå‹¤çµ„", 
                    imgDesc: "æ·é‹ç«™èƒŒæ™¯ï¼Œæ¨¡ç‰¹å…’ç©¿è‘—é˜²æ°´é¢¨è¡£", 
                    copy: "å¾è¾¦å…¬å®¤åˆ°æˆ¶å¤–ï¼Œä¸€ä»¶æå®šã€‚é˜²æ½‘æ°´æ™‚å°šå‰ªè£ã€‚",
                    correct: false
                }
            ];

            const handleSelect = (ad) => {
                if (ad.correct) {
                    onComplete(true, "å®Œç¾é…å°ï¼å°æ–¼ã€Œè¦ªå­éœ²ç‡Ÿæ—ã€ï¼Œå¼·èª¿ã€Œè¼•é¬†ã€èˆ‡ã€Œå®¶åº­æƒ…æ„Ÿã€çš„åœ–ç‰‡è½‰åŒ–ç‡æœ€é«˜ã€‚AI é€éå‹•æ…‹å‰µæ„å„ªåŒ– (DCO) æœƒè‡ªå‹•å°‡é€™çµ„å»£å‘Šæ¨çµ¦é€™é¡æ¨™ç±¤çš„äººã€‚", "Meta Advantage+ / Generative AI");
                } else {
                    onComplete(false, "ç´ æä¸åŒ¹é…ã€‚é€™çµ„å»£å‘Šé›–ç„¶å¥½ï¼Œä½†ä¸é©åˆã€Œè¦ªå­éœ²ç‡Ÿæ—ã€ã€‚çµ¦éŒ¯ç´ ææœƒå°è‡´é»æ“Šç‡ (CTR) ä¸‹é™ï¼Œæµªè²»é ç®—ã€‚", "Meta Advantage+ / Generative AI");
                }
            };

            return (
                <div className="space-y-6">
                    <div className="flex items-center justify-between bg-slate-800 text-white p-4 rounded-xl">
                        <div>
                            <div className="text-xs text-slate-400 uppercase tracking-wider mb-1">Target Audience</div>
                            <div className="text-xl font-bold flex items-center gap-2">
                                <Icon name="Users" /> {persona.tag}
                            </div>
                        </div>
                        <div className="text-right text-sm text-slate-300 max-w-xs">
                            åå¥½ï¼š{persona.needs}
                        </div>
                    </div>

                    <div className="bg-blue-50 p-4 rounded-lg border border-blue-200 text-sm text-blue-800">
                        <span className="font-bold">ä»»å‹™ç›®æ¨™ï¼š</span> AI å·²ç¶“é–å®šäº†ä¸Šè¿°æ—ç¾¤ï¼Œè«‹é¸æ“‡æœ€èƒ½æ‰“å‹•ä»–å€‘çš„å»£å‘Šç´ æã€‚
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                        {ads.map(ad => (
                            <div key={ad.id} onClick={() => handleSelect(ad)} className="group cursor-pointer bg-white rounded-xl overflow-hidden border-2 border-transparent hover:border-emerald-500 shadow-md transition-all hover:-translate-y-1">
                                <div className="h-32 bg-slate-200 flex items-center justify-center text-center p-4 text-slate-500 group-hover:bg-slate-100">
                                    <div><Icon name="Image" className="mx-auto mb-2"/>{ad.imgDesc}</div>
                                </div>
                                <div className="p-4">
                                    <h3 className="font-bold text-lg mb-2">{ad.title}</h3>
                                    <p className="text-sm text-slate-600">{ad.copy}</p>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        // --- Main App ---

        const App = () => {
            const [gameState, setGameState] = useState('intro'); // intro, playing, summary
            const [currentStageIdx, setCurrentStageIdx] = useState(0);
            const [score, setScore] = useState(0);
            const [modal, setModal] = useState({ isOpen: false, isCorrect: false, message: '', tool: '' });
            const [showKnowledge, setShowKnowledge] = useState(false);

            const currentStage = STAGES[currentStageIdx];

            const startGame = () => {
                setGameState('playing');
                setCurrentStageIdx(0);
                setScore(0);
            };

            const handleStageComplete = (isCorrect, message, tool) => {
                setModal({ isOpen: true, isCorrect, message, tool });
                if (isCorrect) {
                    setScore(s => s + 25);
                }
            };

            const nextStage = () => {
                setModal({ ...modal, isOpen: false });
                if (!modal.isCorrect) return; // Must get it right to proceed (educationally better)
                
                if (currentStageIdx < STAGES.length - 1) {
                    setCurrentStageIdx(prev => prev + 1);
                } else {
                    setGameState('summary');
                }
            };

            // --- Intro Screen ---
            if (gameState === 'intro') {
                return (
                    <div className="min-h-screen flex items-center justify-center p-4">
                        <div className="max-w-2xl w-full bg-white/95 backdrop-blur-xl rounded-2xl shadow-2xl p-8 md:p-12 text-center animate-fade-in">
                            <div className="inline-flex p-4 rounded-full bg-emerald-100 text-emerald-600 mb-6">
                                <Icon name="Mountain" size={48} />
                            </div>
                            <h1 className="text-4xl font-black text-slate-900 mb-4">AI è¡ŒéŠ·é•·æ¨¡æ“¬å™¨</h1>
                            <p className="text-xl text-slate-600 mb-8">
                                æ­¡è¿ä¾†åˆ°ã€Œé‡è¶£æ¢ç´¢ (WildQuest)ã€ã€‚<br/>
                                æˆ‘å€‘æ˜¯ä¸€å€‹æˆ¶å¤–å“ç‰Œï¼Œä½†æ•¸æ“šæ•£äº‚ã€å»£å‘Šè½‰åŒ–ç‡ä½ã€‚<br/>
                                ä½ çš„ä»»å‹™æ˜¯å°å…¥ <span className="font-bold text-emerald-600">AI è§£æ±ºæ–¹æ¡ˆ</span>ï¼Œå¸¶é ˜å“ç‰Œé€²è¡Œæ•¸ä½è½‰å‹ã€‚
                            </p>
                            
                            <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8 text-left">
                                {STAGES.map((s, i) => (
                                    <div key={i} className="bg-slate-50 p-3 rounded-lg border border-slate-100">
                                        <div className="text-xs text-slate-400 font-bold uppercase mb-1">Step {i+1}</div>
                                        <div className="text-sm font-bold text-slate-700">{s.subtitle}</div>
                                    </div>
                                ))}
                            </div>

                            <button 
                                onClick={startGame}
                                className="px-8 py-4 bg-emerald-600 hover:bg-emerald-700 text-white text-lg font-bold rounded-xl shadow-lg shadow-emerald-200 transition-all transform hover:scale-105"
                            >
                                é–‹å§‹æŒ‘æˆ° (Start Challenge)
                            </button>
                        </div>
                    </div>
                );
            }

            // --- Summary Screen ---
            if (gameState === 'summary') {
                return (
                    <div className="min-h-screen flex items-center justify-center p-4">
                        <div className="max-w-2xl w-full bg-white/95 backdrop-blur-xl rounded-2xl shadow-2xl p-8 md:p-12 text-center animate-fade-in">
                            <div className="mb-6 text-emerald-500">
                                <Icon name="Trophy" size={64} className="mx-auto" />
                            </div>
                            <h2 className="text-3xl font-black text-slate-900 mb-4">è½‰å‹æˆåŠŸï¼</h2>
                            <div className="text-5xl font-black text-slate-800 mb-2">{score}%</div>
                            <p className="text-slate-500 mb-8">è¡ŒéŠ·ç²¾æº–åº¦å¤§å¹…æå‡</p>

                            <div className="bg-slate-50 rounded-xl p-6 text-left mb-8 space-y-4">
                                <h3 className="font-bold text-slate-800 flex items-center gap-2">
                                    <Icon name="BookOpen" size={20}/> ä½ çš„ AI å·¥å…·åŒ…å›é¡§ï¼š
                                </h3>
                                <ul className="space-y-2 text-sm text-slate-600">
                                    <li className="flex gap-2"><Icon name="Check" size={16} className="text-emerald-500"/> <strong>æ•¸æ“šæ¸…æ´—ï¼š</strong> ä½¿ç”¨ Python/ChatGPT è§£æ±ºé€šè·¯æ•¸æ“šä¸äº’é€šã€‚</li>
                                    <li className="flex gap-2"><Icon name="Check" size={16} className="text-emerald-500"/> <strong>æ¨™ç±¤è­˜åˆ¥ï¼š</strong> ä½¿ç”¨ NLP åˆ†ææ¨¡ç³Šçš„å®¢æˆ¶è©•è«–ã€‚</li>
                                    <li className="flex gap-2"><Icon name="Check" size={16} className="text-emerald-500"/> <strong>é æ¸¬æ¨¡å‹ï¼š</strong> ä½¿ç”¨ CDP/CRM é æ¸¬é«˜åƒ¹å€¼è¨ªå®¢ã€‚</li>
                                    <li className="flex gap-2"><Icon name="Check" size={16} className="text-emerald-500"/> <strong>è‡ªå‹•åŒ–åŸ·è¡Œï¼š</strong> çµ¦å°çš„äººçœ‹å°çš„ç´ æã€‚</li>
                                </ul>
                            </div>

                            <button 
                                onClick={startGame}
                                className="text-slate-500 hover:text-slate-800 font-bold underline"
                            >
                                é‡æ–°éŠç©
                            </button>
                        </div>
                    </div>
                );
            }

            // --- Gameplay Screen ---
            return (
                <div className="container mx-auto max-w-4xl p-4 md:p-8 min-h-screen flex flex-col">
                    {/* Header */}
                    <div className="flex justify-between items-center mb-6 text-white">
                        <div>
                            <h1 className="font-bold text-xl flex items-center gap-2">
                                <Icon name="Mountain" /> é‡è¶£æ¢ç´¢ WildQuest
                            </h1>
                            <div className="text-slate-400 text-sm">AI è½‰å‹å°ˆæ¡ˆé€²è¡Œä¸­...</div>
                        </div>
                        <button 
                            onClick={() => setShowKnowledge(!showKnowledge)}
                            className="flex items-center gap-2 bg-white/10 hover:bg-white/20 px-4 py-2 rounded-lg transition-colors backdrop-blur-sm"
                        >
                            <Icon name="Book" size={18} /> çŸ¥è­˜åº«
                        </button>
                    </div>

                    {/* Main Content */}
                    <div className="flex-1 flex gap-6 relative">
                        {/* Main Stage Area */}
                        <div className="flex-1">
                            <div className="bg-white rounded-2xl shadow-xl overflow-hidden">
                                {/* Progress */}
                                <div className="p-6 md:p-8 pb-0">
                                    <div className="flex justify-between text-sm font-bold text-slate-400 mb-2">
                                        <span>LEVEL {currentStage.id}/4</span>
                                        <span>SCORE: {score}</span>
                                    </div>
                                    <ProgressBar current={currentStage.id} total={4} />
                                    
                                    <div className="mb-6">
                                        <h2 className="text-2xl font-bold text-slate-800 mb-1">{currentStage.title}</h2>
                                        <p className="text-emerald-600 font-mono text-sm font-bold mb-4">{currentStage.subtitle}</p>
                                        <p className="text-slate-600">{currentStage.desc}</p>
                                    </div>
                                </div>

                                {/* Interaction Area */}
                                <div className="bg-slate-50 border-t border-slate-100 p-6 md:p-8 min-h-[400px]">
                                    {currentStage.type === 'matching' && <Stage1_Matching onComplete={handleStageComplete} />}
                                    {currentStage.type === 'tagging' && <Stage2_Tagging onComplete={handleStageComplete} />}
                                    {currentStage.type === 'prediction' && <Stage3_Prediction onComplete={handleStageComplete} />}
                                    {currentStage.type === 'execution' && <Stage4_Execution onComplete={handleStageComplete} />}
                                </div>
                            </div>
                        </div>

                        {/* Knowledge Sidebar (Desktop) / Drawer (Mobile) */}
                        {showKnowledge && (
                            <div className="absolute md:static inset-0 md:inset-auto bg-slate-900/50 md:bg-transparent z-40 md:z-0 md:w-64 animate-fade-in">
                                <div className="bg-white h-full md:h-auto md:rounded-xl p-6 shadow-xl md:sticky md:top-8">
                                    <div className="flex justify-between items-center mb-4">
                                        <h3 className="font-bold text-slate-800">AI è¡ŒéŠ·å­—å…¸</h3>
                                        <button onClick={() => setShowKnowledge(false)} className="md:hidden"><Icon name="X" /></button>
                                    </div>
                                    <div className="space-y-4 h-full overflow-y-auto">
                                        {Object.entries(KNOWLEDGE_BASE).map(([key, val]) => (
                                            <div key={key} className="border-b border-slate-100 pb-2 last:border-0">
                                                <div className="font-bold text-emerald-600 text-sm mb-1">{key}</div>
                                                <div className="text-xs text-slate-600 leading-relaxed">{val}</div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>

                    <FeedbackModal 
                        isOpen={modal.isOpen} 
                        isCorrect={modal.isCorrect}
                        message={modal.message}
                        tool={modal.tool}
                        onNext={nextStage}
                    />
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>

    <script>
        // Fix for Lucide icon rendering in React
        window.addEventListener('load', () => {
            if (window.lucide) {
                window.lucide.createIcons();
            }
        });
    </script>
</body>
</html>